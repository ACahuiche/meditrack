{
  "entities": {
    "Medication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Medication",
      "type": "object",
      "description": "Represents a medication entry with its details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Medication entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the medication."
        },
        "description": {
          "type": "string",
          "description": "Optional description of the medication."
        },
        "dosageFrequencyHours": {
          "type": "number",
          "description": "Frequency of dosage in hours."
        },
        "durationDays": {
          "type": "number",
          "description": "Duration of medication intake in days."
        },
        "initialDoseTime": {
          "type": "string",
          "description": "Time of the first dose.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "dosageFrequencyHours",
        "durationDays",
        "initialDoseTime"
      ]
    },
    "DosageSchedule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DosageSchedule",
      "type": "object",
      "description": "Represents the generated dosage schedule for a medication.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DosageSchedule entity."
        },
        "medicationId": {
          "type": "string",
          "description": "Reference to Medication. (Relationship: Medication 1:N DosageSchedule)"
        },
        "days": {
          "type": "array",
          "description": "Array of days in the dosage schedule",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "medicationId",
        "days"
      ]
    },
    "DosageDay": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DosageDay",
      "type": "object",
      "description": "Represents a single day in the dosage schedule.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DosageDay entity."
        },
        "dosageScheduleId": {
          "type": "string",
          "description": "Reference to DosageSchedule. (Relationship: DosageSchedule 1:N DosageDay)"
        },
        "dayNumber": {
          "type": "number",
          "description": "Day number in the schedule (e.g., 1, 2, 3)."
        },
        "dosageIntervals": {
          "type": "array",
          "description": "Array of dosage intervals for the day.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "dosageScheduleId",
        "dayNumber",
        "dosageIntervals"
      ]
    },
    "DosageInterval": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DosageInterval",
      "type": "object",
      "description": "Represents a single dosage interval within a day.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DosageInterval entity."
        },
        "dosageDayId": {
          "type": "string",
          "description": "Reference to DosageDay. (Relationship: DosageDay 1:N DosageInterval)"
        },
        "time": {
          "type": "string",
          "description": "Time of the dosage interval.",
          "format": "date-time"
        },
        "taken": {
          "type": "boolean",
          "description": "Indicates whether the dosage has been taken."
        }
      },
      "required": [
        "id",
        "dosageDayId",
        "time",
        "taken"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/medications/{medicationId}",
        "definition": {
          "entityName": "Medication",
          "schema": {
            "$ref": "#/backend/entities/Medication"
          },
          "description": "Stores medication details for each user. Path-based ownership ensures that only the user can access their own medications.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the medication."
            },
            {
              "name": "medicationId",
              "description": "The ID of the medication."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/medications/{medicationId}/dosageSchedules/{dosageScheduleId}",
        "definition": {
          "entityName": "DosageSchedule",
          "schema": {
            "$ref": "#/backend/entities/DosageSchedule"
          },
          "description": "Stores dosage schedules associated with a specific medication. Path-based ownership continues to ensure only the owning user has access.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the medication and schedule."
            },
            {
              "name": "medicationId",
              "description": "The ID of the medication associated with the schedule."
            },
            {
              "name": "dosageScheduleId",
              "description": "The ID of the dosage schedule."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/medications/{medicationId}/dosageSchedules/{dosageScheduleId}/dosageDays/{dosageDayId}",
        "definition": {
          "entityName": "DosageDay",
          "schema": {
            "$ref": "#/backend/entities/DosageDay"
          },
          "description": "Stores daily dosage information for a schedule.  Path-based ownership ensures data is scoped to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "medicationId",
              "description": "The ID of the medication."
            },
            {
              "name": "dosageScheduleId",
              "description": "The ID of the dosage schedule."
            },
            {
              "name": "dosageDayId",
              "description": "The ID of the dosage day."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/medications/{medicationId}/dosageSchedules/{dosageScheduleId}/dosageDays/{dosageDayId}/dosageIntervals/{dosageIntervalId}",
        "definition": {
          "entityName": "DosageInterval",
          "schema": {
            "$ref": "#/backend/entities/DosageInterval"
          },
          "description": "Stores individual dosage intervals for a specific day, including the time and taken status. Path-based ownership ensures data is scoped to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "medicationId",
              "description": "The ID of the medication."
            },
            {
              "name": "dosageScheduleId",
              "description": "The ID of the dosage schedule."
            },
            {
              "name": "dosageDayId",
              "description": "The ID of the dosage day."
            },
            {
              "name": "dosageIntervalId",
              "description": "The ID of the dosage interval."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage medication entries, dosage schedules, and individual dosage intervals for users. It uses a hierarchical path structure to establish clear ownership and relationships between entities, which simplifies security rules and ensures data integrity. The structure prioritizes authorization independence by using path-based ownership, removing the need for `get()` calls in security rules.  All collections are designed with homogeneous security posture to avoid mixing data with different access requirements.\n\nThe structure supports the core features of the application, including medication entry, dosage schedule generation, and dosage tracking. It maintains data clarity through explicit state modeling (the 'taken' field in DosageInterval) and a predictable schema.\n\nTo support list operations (QAPs), the data is segregated into user-owned subcollections, which allows for secure listing of only the current user's data."
  }
}